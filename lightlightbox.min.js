var LightLightBox=function(){that=this,this.options={overlayIndex:101,overlayOpacity:.85,imagePadding:50,transitionSpeed:"0.35s",transitionSpeedMS:350,caption:!0},this.ids={overlay:"lightlightbox-overlay",imageId:"lightlightbox-image",imageCont:"lightlightbox-cont",closeButton:"lightlightbox-close",nextButton:"lightlightbox-next",previousButton:"lightlightbox-prev",load:"lightlightbox-loading",content:"lightlightbox-content",caption:"lightlightbox-caption",container:"lightlightbox-container"},this.controlStyle="position:absolute;cursor:pointer;margin-top:-36px;z-index:"+(this.options.overlayIndex+3)+";color:#fff;text-shadow:0 0 10px #000;font-weight:100;font-size:48px;padding:10px;",this.transitions="-webkit-transition:opacity "+this.options.transitionSpeed+" ease-in-out;-moz-transition:opacity "+this.options.transitionSpeed+" ease-in-out;-ms-transition:opacity "+this.options.transitionSpeed+" ease-in-out;-o-transition:opacity "+this.options.transitionSpeed+" ease-in-out;transition:opacity "+this.options.transitionSpeed+" ease-in-out;",this.unselectable="-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;user-select:none;",this.invisible="visibility:hidden;opacity:0;",this.bullet='<div style="width:20px;display:inline-block;"><span style="'+this.invisible+this.transitions+'">&bull;</span></div>',this.template={overlayHTML:'<div id="'+this.ids.overlay+'" style="top:0;left:0;z-index:'+this.options.overlayIndex+";background-color:#000;position:fixed;filter:alpha(opacity="+100*this.options.overlayOpacity+");width:100%;height:100%;"+this.invisible+this.transitions+'"></div>',imageBox:'<div id="'+this.ids.imageCont+'" style="font-family:Arial;top:0;margin:auto;position:absolute;z-index:'+(this.options.overlayIndex+2)+";"+this.invisible+this.transitions+'"><div id="'+this.ids.closeButton+'" style="position:absolute;cursor:pointer;top:-10px;right:-10px;z-index:'+(this.options.overlayIndex+3)+";color:#000;background:#fff;border-radius:27px;padding:0;height:27px;width:27px;text-align:center;line-height:1.1;font-weight:100;font-size:27px;box-shadow:-3px 3px 15px #000;"+this.unselectable+'">&#215;</div></div>',loading:'<div id="'+this.ids.load+'" style="color:#fff;font-size:26px;position:fixed;left:0;top:50%;text-align:center;width:100%;z-index:'+(this.options.overlayIndex+1)+";"+this.invisible+this.unselectable+'">'+this.bullet+this.bullet+this.bullet+"</div>",previousButton:'<div style="'+this.controlStyle+"left:-40px;"+this.unselectable+'" id="'+this.ids.previousButton+'">&lsaquo;</div>',nextButton:'<div style="'+this.controlStyle+"right:-40px;"+this.unselectable+'" id="'+this.ids.nextButton+'">&rsaquo;</div>',caption:'<div id="'+this.ids.caption+'" style="position:absolute;padding:15px;bottom:0;left:0;color:#fff;background:#000;box-sizing:border-box;background:rgba(0,0,0,'+this.options.overlayOpacity+')"></div>',container:'<div id="'+this.ids.container+'" style="position:static;"></div>'},this.origImageWidth=0,this.origImageHeight=0,this.timer=0,this.galleryCount=0,this.subGalleryId=!1,this.currentImage=0,this.lightboxOpen=!1,this.gallery=[],this.context="",this.noResize=!1,this.loadingTimer=null,this.transitioning=!1,this.lightboxGallery=[],this.image=new Image,this.next=function(t){var i;if(!(i=t.nextSibling))return!1;for(;1!=i.nodeType;)if(!(i=i.nextSibling))return!1;return i},this.hide=function(t){t.style.opacity=0,setTimeout(function(){t.style.visibility="hidden"},this.options.transitionSpeedMS)},this.show=function(t,i){t.style.opacity=i||1,t.style.visibility="visible"},this.addEvent=function(t,i,e){i.addEventListener?i.addEventListener(t,e,!1):i.attachEvent?i.attachEvent("on"+t,e):i[t]=e},this.getImageAttrInNode=function(t,i){if(t)for(var e=0;e<t.length;e++)if("IMG"===t[e].tagName)return t[e].getAttribute(i);return""},this.hideScrollbars=function(){document.documentElement.style.overflow="hidden",document.body.scroll="no"},this.showScrollbars=function(){document.documentElement.style.overflow="auto",document.body.scroll="yes"},this.isLightboxLink=function(t){return t.getAttribute("rel")&&"lightbox"===t.getAttribute("rel")||t.getAttribute("data-lightbox")&&"lightbox"===t.getAttribute("data-lightbox")},this.id=function(t){return document.getElementById(t)},this.append=function(t,i){t.insertAdjacentHTML("beforeend",i)},this.resizeImage=function(){if(this.lightboxOpen){var t=this.options.imagePadding,i=window.pageYOffset||document.documentElement.scrollTop,e=window.pageXOffset||document.documentElement.scrollLeft,s=Math.max(document.documentElement.clientHeight,window.innerHeight||0)-t/2,o=Math.max(document.documentElement.clientWidth,window.innerWidth||0)-t,n=this.origImageHeight,h=this.origImageWidth;if(!n){var a=this.id(this.ids.imageId).childNodes,l=a[1];l||(l=a[0]),n=l.offsetHeight}h||(h=o-t);var d=h,r=n,g=!1;if(!this.noResize)for(;!g;)d+t>o?(d=o-t,r=n/h*d):r+t>s?(r=s-t,"content"!==this.context&&(d=h/n*r)):g=!0;var c=i+s/2-r/2+t/4,u=e+o/2-d/2+t/2;this.id(this.ids.imageCont).style.top=Math.floor(c)+"px",this.id(this.ids.imageCont).style.left=Math.floor(u)+"px",this.id(this.ids.imageCont).style.width=Math.floor(d)+"px",this.id(this.ids.imageCont).style.height=Math.floor(r)+"px",this.galleryCount>1&&(this.id(this.ids.nextButton).style.top=Math.floor(r/2)+"px",this.id(this.ids.previousButton).style.top=Math.floor(r/2)+"px"),this.id(this.ids.imageId).style.width=Math.floor(d)+"px",this.id(this.ids.imageId).style.height=Math.floor(r)+"px"}},this.loadingAnim=function(){that.timer>=3?that.hide(that.id(that.ids.load).childNodes[that.timer-3].childNodes[0]):that.show(that.id(that.ids.load).childNodes[that.timer].childNodes[0]),that.timer++,that.timer>=6&&(that.timer=0)},this.setImage=function(){this.lightboxOpen=!0,this.hideScrollbars(),this.resizeImage(),this.show(this.id(this.ids.imageCont))},this.loadImage=function(t,i,e,s){if(this.lightboxOpen)if(this.noResize=!1,e)this.addNavigation(),this.append(this.id(this.ids.imageCont),'<div id="'+this.ids.imageId+'" style="background:#fff;overflow-y:auto;z-index:'+(this.options.overlayIndex+2)+';">'+e+"</div>"),s?(this.noResize=!0,this.origImageWidth=s[0],this.origImageHeight=s[1]):(this.origImageWidth=null,this.origImageHeight=null,this.resizeImage()),this.setImage();else{this.show(this.id(this.ids.load)),this.loadingTimer=setInterval(this.loadingAnim,400);var o='<img id="'+this.ids.imageId+'" style="z-index:'+(this.options.overlayIndex+2)+';" src="'+t+'" alt="'+i+'" width="0" height="0">';this.image=new Image,this.image.onload=function(){that.addNavigation(),that.stopLoading(),that.append(that.id(that.ids.imageCont),o),that.origImageWidth=that.image.width,that.origImageHeight=that.image.height,that.options.caption&&i&&(that.append(that.id(that.ids.imageCont),that.template.caption),that.append(that.id(that.ids.caption),i)),that.setImage()},this.image.src=t}},this.stopLoading=function(){this.timer=0,clearInterval(this.loadingTimer),this.hide(this.id(this.ids.load));for(var t=0;t<3;t++)this.hide(this.id(this.ids.load).childNodes[t].childNodes[0])},this.addNavigation=function(){this.append(this.id(this.ids.container),this.template.imageBox),this.galleryCount>1&&(this.append(this.id(this.ids.imageCont),this.template.nextButton),this.append(this.id(this.ids.imageCont),this.template.previousButton),this.addEvent("click",this.id(this.ids.nextButton),function(){that.navigate(!0)}),this.addEvent("click",this.id(this.ids.previousButton),function(){that.navigate(!1)})),this.addEvent("click",this.id(this.ids.closeButton),function(){that.close()})},this.navigate=function(t){this.transitioning||(this.lightboxOpen=!0,this.hideScrollbars(),t?(this.currentImage++,this.currentImage>this.galleryCount-1&&(this.currentImage=0)):(this.currentImage--,this.currentImage<0&&(this.currentImage=this.galleryCount-1)),this.hide(this.id(this.ids.imageCont)),this.transitioning=!0,setTimeout(function(){var t,i,e=that.id(that.ids.imageCont);e&&(e.outerHTML=""),"gallery"==that.context?(t=that.gallery[that.subGalleryId][that.currentImage][0],i=that.gallery[that.subGalleryId][that.currentImage][1]):(t=that.lightboxGallery[that.currentImage].getAttribute("href"),"#"!==t&&t!==window.location.href+"#"||(t=that.getImageAttrInNode(that.lightboxGallery[that.currentImage].childNodes,"src")),i=that.getImageAttrInNode(that.lightboxGallery[that.currentImage].childNodes,"alt")),that.loadImage(t,i),that.transitioning=!1},this.options.transitionSpeedMS))},this.close=function(){this.stopLoading(),this.hide(this.id(this.ids.overlay));var t=this.id(this.ids.imageCont);t&&this.hide(this.id(this.ids.imageCont)),this.lightboxOpen=!1,this.showScrollbars(),this.image.onload=null,setTimeout(function(){var t=that.id(that.ids.imageCont);t&&(t.outerHTML="")},this.options.transitionSpeedMS)},this.imageClick=function(t,i){var e="",s="",o=t.getAttribute("rel");o||(o=t.getAttribute("data-lightbox"));var n=!1,h=!1;if("lightbox"==o)e=t.getAttribute("href"),"#"!==e&&e!==window.location.href+"#"||(e=this.getImageAttrInNode(t.childNodes,"src")),s=this.getImageAttrInNode(t.childNodes,"alt"),this.galleryCount=this.lightboxGallery.length,this.currentImage=i;else if("gallery"==o){this.subGalleryId=t.getAttribute("id");var a=t.getAttribute("data-gallery").split(";");this.gallery[this.subGalleryId]=[];for(var l=0;l<a.length;l++)this.gallery[this.subGalleryId][l]=a[l].split(",");e=this.gallery[this.subGalleryId][0][0],s=this.gallery[this.subGalleryId][0][1],this.galleryCount=this.gallery[this.subGalleryId].length,this.currentImage=0}else{var d=this.next(t);if(d){n=d.innerHTML;var r=d.getAttribute("data-width"),g=d.getAttribute("data-height");r&&g&&(h=[r,g])}this.galleryCount=0}this.lightboxOpen=!0,this.context=o,this.show(this.id(this.ids.overlay),this.options.overlayOpacity),this.loadImage(e,s,n,h)},this.append(document.body,this.template.container),this.append(this.id(this.ids.container),this.template.loading),this.append(this.id(this.ids.container),this.template.overlayHTML);for(var t=document.getElementsByTagName("*"),i=0;i<t.length;i++){var e=t[i].getAttribute("className");if(e)for(var s=e.split(" "),o=0;o<s.length;o++)s[o]==this.ids.content&&this.hide(t[i])}this.addEvent("click",document,function(t){for(var i=[t.target||t.srcElement,(t.target?t.target.parentElement:void 0)||t.srcElement.parentElement],e=0;e<i.length;e++)if(i[e]&&"A"===i[e].tagName){var s=!1;if(that.isLightboxLink(i[e])){that.lightboxGallery=[];for(var o=document.getElementsByTagName("a"),n=0;n<o.length;n++)that.isLightboxLink(o[n])&&that.lightboxGallery.push(o[n]);for(var h=0,a=0;a<o.length;a++)that.isLightboxLink(o[a])&&(i[e]===o[a]&&(that.imageClick(i[e],h),s=!0),h++)}else!i[e].getAttribute("data-lightbox")||"gallery"!==i[e].getAttribute("data-lightbox")&&"content"!==i[e].getAttribute("data-lightbox")||(that.imageClick(i[e]),s=!0);s&&(t.preventDefault?t.preventDefault():t.returnValue=!1)}}),this.addEvent("resize",window,function(){that.resizeImage()}),this.addEvent("click",this.id(this.ids.overlay),function(){that.close()})};document.addEventListener("DOMContentLoaded",function(){lightLightBox=new LightLightBox});